---
import Layout from "../../layouts/Layout.astro";
import AuthLayout from "../../components/auth/AuthLayout.astro";
import { SignInView } from "../../components/auth/SignInView";

// Extract query parameters
const returnUrl = Astro.url.searchParams.get("returnUrl") || undefined;
const prefilledEmail = Astro.url.searchParams.get("email") || undefined;
const error = Astro.url.searchParams.get("error");

// Server-side auth check: If user is already authenticated, redirect to returnUrl or /
if (Astro.locals.isAuthenticated && Astro.locals.user) {
  return Astro.redirect(returnUrl || "/");
}
---

<Layout title="Sign in">
  <AuthLayout>
    <SignInView client:load returnUrl={returnUrl} prefilledEmail={prefilledEmail} />
  </AuthLayout>
</Layout>
